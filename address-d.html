<!doctype html>
<!--[if lt IE 7]>      <html lang="en-gb" dir="ltr" class="no-js lt-ie10 lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html lang="en-gb" dir="ltr" class="no-js lt-ie10 lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html lang="en-gb" dir="ltr" class="no-js lt-ie10 lt-ie9"> <![endif]-->
<!--[if IE 9]>         <html lang="en-gb" dir="ltr" class="no-js lt-ie10"> <![endif]-->
<!--[if gt IE 9]><!--> <html lang="en-gb" dir="ltr" class="no-js"> <!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <title>How is â€¦ related to the people below? - 2017 Census Test</title>
    <meta content="" name="description">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <link rel="apple-touch-icon" sizes="180x180" href="/s/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" href="/s/favicons/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/s/favicons/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/s/favicons/manifest.json">
    <link rel="mask-icon" href="/s/favicons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="theme-color" content="#ffffff">
    <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
    <![endif]-->
    <!--[if gt IE 8]><!-->
    <script>document.documentElement.className = document.documentElement.className.replace('no-js','has-js')</script>
    <!--<![endif]-->


    <!--[if (gt IE 9) | (IEMobile)]><!-->
    <link href="/s/css/themes/census/responsive.css" rel="stylesheet">
    <!--<![endif]-->
    <!--[if (lte IE 9) & (!IEMobile)]>
    <link href="/s/css/census/fixed.min.css?q=afe0c3fc5f881be5a231a218296436c68cc7fa26" rel="stylesheet">
    <![endif]-->

    <link href="/s/css/lib/autocomplete.css" rel="stylesheet">
    <style>
        .pac-container-wrapper {
            position : relative;
        }

        .address-component {
            z-index : 10;
            position : relative;
        }

        .pac-container {
            position : absolute;
            width : 19.6rem;
            max-height: 265px;
            margin-top : -1px;
            margin-left : -1px;
            overflow-x : hidden;
            overflow-y : auto;
            background-color: #fff;
            border: 2px solid #4263c2;
            border-top: 0;
            color: #34384b;
            padding: 0;
        }

        .pac-logo:after { content: none !important; }

        .pac-item {
            display : block;
            width : 100%;
            padding: .8rem .6rem;
            text-align : left;
            cursor: pointer;
            font-family: "Lato", "Helvetica Neue", Arial, sans-serif;
            border : none;
            border-top: 2px solid #4263c2;
            background : none;
        }

        /**
        * Item is focused
        */
        .pac-item.focused {
            background-color : #4263c2;
        }

        .pac-item.focused .pac-matched {
            color: #fff;
        }
        /**
        * End item is focused
        */

        .pac-item:hover,
        .pac-item:hover .pac-item-query,
        .pac-item:hover .pac-matched {
            background-color: #4263c2;
            color: white;
        }


        .pac-item,
        .pac-item-query {
            font-size: 17px;
            color : #999;
        }

        .pac-item-query {
            padding-right : 3px;
        }

        .pac-matched {
            color : #000;
        }

        .pac-item-query:after {
            content: ',';
        }

        .hide {
            display : none;
        }

        /**
         * Reset guidence styles
         */
        .guidance.guidance--basic-toggle {
            margin-left : 0;
        }

        .guidance--basic-toggle .guidance__link {
            padding-left : 0;
        }

        .guidance--basic-toggle .guidance__link::before {
            width : 0;
        }

        .guidance--basic-toggle .guidance__main {
            margin-left : 0;
        }

        .guidance--basic-toggle .guidance__content {
            margin-left : 0;
            padding-left : 0;
            border-left : none;
        }
        /**
         * End reset guidence styles
         */

        @media only screen and (max-width: 500px) {
            .pac-container {
                width : auto;
            }
        }
    </style>
</head>

<body>



<div class="page">

    <div class="page__content">

        <div class="skip">
            <a class="skip__link" href="#main">Skip to content</a>
        </div>

        <header class="page__header">

            <header class="header header--census">
                <div class="header__help is-closed js-help-body">
                    <div class="header__container container">
                        <div class="header__title ">Help and support &ndash;</div>
                        <ul class="header__nav nav nav--horizontal">
                            <li class="nav__item">
                                <span class="mars" role="presentation">Call </span> <a class="venus nav__link" href="tel:03000683001"><span class="u-vh">For help call </span>0300 068 3001</a>
                            </li>
                            <li class="nav__item">
                                <a class="venus nav__link external" href="http://www.ons.gov.uk/census/help" target="_blank" rel="noopener noreferrer">Online Help</a>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="header__container container">
                    <div class="header__logo">
                        <img src="/s/img/theme/census/census-logo.svg?q=afe0c3fc5f881be5a231a218296436c68cc7fa26" alt="2017 Census" />
                    </div>
                    <button class="header__btn btn btn--light btn--border js-help-btn u-hidden"

                            data-ga="click" data-ga-category="Help" data-ga-action="Help and support">
                        Help and support
                    </button>
                </div>
            </header>
        </header>

        <div class="page__subheader">
            <div class="container"></div>
        </div>

        <div class="page__container container">

            <div class="grid grid--reverse">
                <div class="grid__col col-4@m"></div>

                <div class="grid__col col-7@m pull-1@m">
                    <main role="main" id="main" class="page__main">

                        <form class="form qa-questionnaire-form" role="form" method="POST" autocomplete="off" novalidate>
                            <input id="csrf_token" name="csrf_token" type="hidden" value="ImUyNGQ4ZTliMTQxZDY4MGI3NzgyYjkyMjI4M2Y3ZWRmMGJlZmZjZWYi.DKKFlA.U3YKd3C5S0R9193pylUknvdyOTc">

                            <div class="group" id="who-lives-here-relationship">

                                <block class="block" id="household-relationships">

                                    <p class="block__title neptune" data-qa="block-title"></p>

                                    <div class="question question--repeatinganswer" id="household-relationships-question">

                                        <h1 class="question__title saturn">What is your address?</h1>

                                        <fieldset>
                                            <div class="question__answers">

                                                <div class="question__answer">
                                                    <div class="answer">
                                                        <div class="answer__fields">
                                                            <div class="field field--select">

                                                                <label class="label venus">
                                                                    Search using your address or postcode
                                                                </label>

                                                                <div id="locationField" class="address-component">
                                                                    <input class="input input--text" id="addressAutocomplete" placeholder=""type="text" />

                                                                    <div class="pac-container-wrapper">
                                                                        <div class="pac-container pac-logo hide"></div>
                                                                    </div>
                                                                </div>
                                                                <a id="address-details-trigger" class="mars btn btn--link" aria-controls="guidance-permanent-or-family-home-answer-body" href="#guidance-permanent-or-family-home-answer">Enter your address manually</a>
                                                                <button id="address-start-again-trigger" class="mars btn btn--link hide" href="#guidance-permanent-or-family-home-answer">Start again</button>

                                                                <div id="guidance" class="guidance guidance--basic-toggle js-details address-details" data-hide-label="Enter your address manually" data-show-label="Enter your address manually">
                                                                    <div class="guidance__main js-details-body" aria-hidden="true" id="guidance-permanent-or-family-home-answer-body">
                                                                        <div class="guidance__content mars">

                                                                            <div id="address">
                                                                                <p class="neptune">Your Address</p>
                                                                                <label class="label venus" for="street_number">House name or number</label>
                                                                                <input class="input input--text" id="street_number" /><br />

                                                                                <label class="label venus" for="organisation_name">Organisation name</label>
                                                                                <input class="input input--text" id="organisation_name" /><br />

                                                                                <label class="label venus" for="route">Street address</label>
                                                                                <input class="input input--text" id="route" /><br />

                                                                                <label class="label venus" for="postal_town">City or town</label>
                                                                                <input class="input input--text" id="postal_town" /><br />

                                                                                <label class="label venus" for="county">County (Optional)</label>
                                                                                <input class="input input--text" id="county" /><br />

                                                                                <label class="label venus" for="postal_code">Post code</label>
                                                                                <input class="input input--text" id="postal_code" /><br />

                                                                                <label class="label venus" for="country">Country</label>
                                                                                <input class="input input--text" id="country" /><br />
                                                                            </div>

                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <br />
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </fieldset>
                                    </div>
                                </block>
                            </div>

                            <button class="btn btn--primary btn--lg" data-qa="btn-submit" type="submit" name="action[save_continue]">Save and continue</button>


                            <div class="u-mb-m">
                                <button class="btn btn--link mars js-btn-save" type="submit" name="action[save_sign_out]"
                                        data-ga="click" data-ga-category="Navigation" data-ga-action="Save and complete later click">Save and complete later</button>
                            </div>
                        </form>


                        <a class="page__previous page__previous--bottom"

                           data-ga="click" data-ga-label="bottom" data-ga-category="Navigation" data-ga-action="Previous link click"
                           href="/questionnaire/census/household/ewv5eFkd/who-lives-here/0/overnight-visitors" id="bottom-previous">Previous</a>

                    </main>
                </div>
            </div>


        </div>
    </div>

    <footer class="page__footer">

        <footer class="footer2 page__footer2">
            <div class="footer2-nav container" role="contentinfo">

                <div class="grid container">
                    <div class>
                        <div class="grid__col col-4@m">
                            <div class="footer2-nav__heading">
                                <p class="venus"><strong>Legal information</strong></p>
                            </div>
                            <ul class="list footer__list">
                                <li class="footer2-nav__item">
                                    <a href="/cookies-privacy"
                                       class="footer2__link" target="_blank">Cookies and privacy</a>
                                </li>
                            </ul>
                        </div>

                        <div class="grid__col col-4@m">
                            <div class="footer2-nav__heading">
                                <p class="venus"><strong>About ONS</strong></p>
                            </div>
                            <ul class="list footer__list">
                                <li class="footer2-nav__item">
                                    <a href="https://www.ons.gov.uk/aboutus/whatwedo" target="_blank" class="footer2__link">What
                                        we
                                        do</a>
                                </li>
                                <li class="footer2-nav__item">
                                    <a href="/contact-us" target="_blank"
                                       class="footer2__link">Contact us</a>
                                </li>
                                <li class="footer2-nav__item">
                                    <a href="https://www.ons.gov.uk/help/accessibility" target="_blank"
                                       class="footer2__link">Accessibility</a>
                                </li>
                            </ul>
                        </div>

                        <div class="grid__col col-4@m">
                            <div class="footer2-nav__heading">
                                <p class="venus"><strong>Statistics</strong></p>
                            </div>
                            <ul class="list footer__list">
                                <li class="footer2-nav__item">
                                    <a href="https://www.statisticsauthority.gov.uk/about-the-authority/" target="_blank"
                                       class="footer2__link">UK Statistics Authority</a>
                                </li>
                                <li class="footer2-nav__item">
                                    <a href="https://www.ons.gov.uk/releasecalendar" target="_blank" class="footer2__link">Release
                                        calendar</a>
                                </li>
                                <li class="footer2-nav__item">
                                    <a class="footer2__link" href="https://www.ons.gov.uk/news" target="_blank">News</a>
                                </li>
                            </ul>
                            </br>
                        </div>
                        <div class="dl__data mars"><img src="/s/img/ogl.svg?q=afe0c3fc5f881be5a231a218296436c68cc7fa26" class="ogl__img"/>
                            All content is available under
                            the <a class="footer2__link"
                                   href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/"
                                   target="_blank">Open
                                Government Licence v3.0</a>, except where otherwise stated

                        </div>
                    </div>
                </div>
            </div>
        </footer>

    </footer>

</div>

<div class="dialog js-dialog" id="dialog" aria-hidden="true"
     data-ga="visible" data-ga-category="Timeout" data-ga-action="Timeout window visible">

    <div class="dialog__overlay" tabindex="-1"></div>

    <div class="dialog__body" role="dialog" aria-labelledby="dialog-title">
        <div role="document">

            <div class="mars u-mb-s">2017 Census Test</div>
            <h1 class="saturn dialog__title" id="dialog-title" tabindex="0">Your session is about to expire</h1>

            <div class="time js-timeout">

                <svg class="time__visual" width="80px" height="80px" viewBox="0 0 80 80" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                    <circle cx="40" cy="40" r="40" stroke="#D3D3D3" stroke-width="6" fill="none"></circle>
                    <circle class="time__circle js-timeout-circle" cx="40" cy="40" r="40" transform="rotate(-90 40 40)" fill="none" stroke="red" stroke-width="6" stroke-linecap="round"></circle>
                </svg>

                <div class="time__text venus js-timeout-time">0:00</div>

            </div>

            <form class="" action="/" method="post">
                <button class="btn btn--primary btn--loader js-timeout-continue" type="button" data-loading-msg="Continuing&hellip;">Continue survey</button>
                <br/>
                <button class="btn btn--secondary btn--border js-timeout-save" type="submit">Save and sign out</button>
            </form>
        </div>
    </div>
</div>

<script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>

<script src="/s/js/services/OrdnanceSurveyService.js"></script>
<script src="/s/js/services/AddressService.js"></script>

<script src="/s/js/components/Typeahead.js"></script>

<script>

	/**
     * Controller bindings
	 */
	$(document).ready(function() {

		var $addressEl = $('#addressAutocomplete'),
			$addressDetailsTrigger = $('#address-details-trigger'),
			$addressStartAgainTrigger = $('#address-start-again-trigger'),
		    $details = $('#guidance-permanent-or-family-home-answer-body'),

            addressComponent = new TypeaheadComponent($('#locationField'), $addressEl),
            fieldToDataMap = {
				houseNameOrNumber: 'street_number',
                organisationName: 'organisation_name',
				streetAddress: 'route',
				cityTown: 'postal_town',
				county: 'county',
				postCode: 'postal_code',
				country: 'country'
            },
            mockData = [{
				"DPA" : {
					"UPRN" : "43014115",
					"UDPRN" : "4547315",
					"ADDRESS" : "1, WARE ROAD, CAERFFILI, CF83 1SX",
					"BUILDING_NUMBER" : "1",
					"THOROUGHFARE_NAME" : "WARE ROAD",
					"POST_TOWN" : "CAERFFILI",
					"POSTCODE" : "CF83 1SX",
					"RPC" : "1",
					"X_COORDINATE" : 314172.0,
					"Y_COORDINATE" : 186296.0,
					"STATUS" : "APPROVED",
					"LOGICAL_STATUS_CODE" : "1",
					"CLASSIFICATION_CODE" : "RD",
					"CLASSIFICATION_CODE_DESCRIPTION" : "Dwelling",
					"LOCAL_CUSTODIAN_CODE" : 6920,
					"LOCAL_CUSTODIAN_CODE_DESCRIPTION" : "CAERPHILLY",
					"POSTAL_ADDRESS_CODE" : "D",
					"POSTAL_ADDRESS_CODE_DESCRIPTION" : "A record which is linked to PAF",
					"BLPU_STATE_CODE_DESCRIPTION" : "Unknown/Not applicable",
					"TOPOGRAPHY_LAYER_TOID" : "osgb1000027048446",
					"LAST_UPDATE_DATE" : "10/02/2016",
					"ENTRY_DATE" : "31/01/2003",
					"LANGUAGE" : "CY",
					"MATCH" : 0.2,
					"MATCH_DESCRIPTION" : "NO MATCH"
				}
			}, {
				"DPA" : {
					"UPRN" : "100100209509",
					"UDPRN" : "4650113",
					"ADDRESS" : "1, GREENACRE DRIVE, BAGILLT, CH6 6DY",
					"BUILDING_NUMBER" : "1",
					"THOROUGHFARE_NAME" : "GREENACRE DRIVE",
					"POST_TOWN" : "BAGILLT",
					"POSTCODE" : "CH6 6DY",
					"RPC" : "1",
					"X_COORDINATE" : 322637.53,
					"Y_COORDINATE" : 374544.52,
					"STATUS" : "APPROVED",
					"LOGICAL_STATUS_CODE" : "1",
					"CLASSIFICATION_CODE" : "RD02",
					"CLASSIFICATION_CODE_DESCRIPTION" : "Detached",
					"LOCAL_CUSTODIAN_CODE" : 6835,
					"LOCAL_CUSTODIAN_CODE_DESCRIPTION" : "FLINTSHIRE",
					"POSTAL_ADDRESS_CODE" : "D",
					"POSTAL_ADDRESS_CODE_DESCRIPTION" : "A record which is linked to PAF",
					"BLPU_STATE_CODE_DESCRIPTION" : "Unknown/Not applicable",
					"TOPOGRAPHY_LAYER_TOID" : "osgb1000034471824",
					"LAST_UPDATE_DATE" : "10/02/2016",
					"ENTRY_DATE" : "10/05/2001",
					"LANGUAGE" : "CY",
					"MATCH" : 0.2,
					"MATCH_DESCRIPTION" : "NO MATCH"
				}
			}, {
				"DPA" : {
					"UPRN" : "200003767038",
					"UDPRN" : "4379366",
					"ADDRESS" : "1, POWELLS PLACE, PORTH, CF39 9RW",
					"BUILDING_NUMBER" : "1",
					"THOROUGHFARE_NAME" : "POWELLS PLACE",
					"POST_TOWN" : "PORTH",
					"POSTCODE" : "CF39 9RW",
					"RPC" : "1",
					"X_COORDINATE" : 302542.0,
					"Y_COORDINATE" : 191420.0,
					"STATUS" : "APPROVED",
					"LOGICAL_STATUS_CODE" : "1",
					"CLASSIFICATION_CODE" : "RD04",
					"CLASSIFICATION_CODE_DESCRIPTION" : "Terraced",
					"LOCAL_CUSTODIAN_CODE" : 6940,
					"LOCAL_CUSTODIAN_CODE_DESCRIPTION" : "RHONDDA CYNON TAF",
					"POSTAL_ADDRESS_CODE" : "D",
					"POSTAL_ADDRESS_CODE_DESCRIPTION" : "A record which is linked to PAF",
					"BLPU_STATE_CODE" : "2",
					"BLPU_STATE_CODE_DESCRIPTION" : "In use",
					"TOPOGRAPHY_LAYER_TOID" : "osgb1000023740817",
					"LAST_UPDATE_DATE" : "10/02/2016",
					"ENTRY_DATE" : "31/10/2002",
					"BLPU_STATE_DATE" : "28/08/2013",
					"LANGUAGE" : "CY",
					"MATCH" : 0.2,
					"MATCH_DESCRIPTION" : "NO MATCH"
				}
			}, {
				"DPA" : {
					"UPRN" : "10009180022",
					"UDPRN" : "21233518",
					"ADDRESS" : "1, DERLWYN, CASTELL-NEDD, SA10 7QU",
					"BUILDING_NUMBER" : "1",
					"THOROUGHFARE_NAME" : "DERLWYN",
					"POST_TOWN" : "CASTELL-NEDD",
					"POSTCODE" : "SA10 7QU",
					"RPC" : "2",
					"X_COORDINATE" : 274086.0,
					"Y_COORDINATE" : 198274.0,
					"STATUS" : "APPROVED",
					"LOGICAL_STATUS_CODE" : "1",
					"CLASSIFICATION_CODE" : "RD",
					"CLASSIFICATION_CODE_DESCRIPTION" : "Dwelling",
					"LOCAL_CUSTODIAN_CODE" : 6930,
					"LOCAL_CUSTODIAN_CODE_DESCRIPTION" : "NEATH PORT TALBOT",
					"POSTAL_ADDRESS_CODE" : "D",
					"POSTAL_ADDRESS_CODE_DESCRIPTION" : "A record which is linked to PAF",
					"BLPU_STATE_CODE" : "2",
					"BLPU_STATE_CODE_DESCRIPTION" : "In use",
					"TOPOGRAPHY_LAYER_TOID" : "osgb1000041956935",
					"LAST_UPDATE_DATE" : "10/02/2016",
					"ENTRY_DATE" : "05/05/2005",
					"BLPU_STATE_DATE" : "05/05/2005",
					"LANGUAGE" : "CY",
					"MATCH" : 0.2,
					"MATCH_DESCRIPTION" : "NO MATCH"
				}
			}, {
				"DPA" : {
					"UPRN" : "10023167356",
					"UDPRN" : "50316895",
					"ADDRESS" : "1, BENTLEY PLACE, WRECSAM, LL13 8DQ",
					"BUILDING_NUMBER" : "1",
					"THOROUGHFARE_NAME" : "BENTLEY PLACE",
					"POST_TOWN" : "WRECSAM",
					"POSTCODE" : "LL13 8DQ",
					"RPC" : "2",
					"X_COORDINATE" : 334126.66,
					"Y_COORDINATE" : 349882.63,
					"STATUS" : "APPROVED",
					"LOGICAL_STATUS_CODE" : "1",
					"CLASSIFICATION_CODE" : "RD06",
					"CLASSIFICATION_CODE_DESCRIPTION" : "Self Contained Flat (Includes Maisonette / Apartment)",
					"LOCAL_CUSTODIAN_CODE" : 6955,
					"LOCAL_CUSTODIAN_CODE_DESCRIPTION" : "WREXHAM",
					"POSTAL_ADDRESS_CODE" : "D",
					"POSTAL_ADDRESS_CODE_DESCRIPTION" : "A record which is linked to PAF",
					"BLPU_STATE_CODE_DESCRIPTION" : "Unknown/Not applicable",
					"TOPOGRAPHY_LAYER_TOID" : "osgb1000002755046329",
					"LAST_UPDATE_DATE" : "10/02/2016",
					"ENTRY_DATE" : "14/04/2008",
					"LANGUAGE" : "CY",
					"MATCH" : 0.2,
					"MATCH_DESCRIPTION" : "NO MATCH"
				}
			}, {
				"DPA" : {
					"UPRN" : "100100001967",
					"UDPRN" : "13682465",
					"ADDRESS" : "10, GARREGLWYD PARK, CAERGYBI, LL65 1NW",
					"BUILDING_NUMBER" : "10",
					"THOROUGHFARE_NAME" : "GARREGLWYD PARK",
					"POST_TOWN" : "CAERGYBI",
					"POSTCODE" : "LL65 1NW",
					"RPC" : "1",
					"X_COORDINATE" : 223898.0,
					"Y_COORDINATE" : 382515.0,
					"STATUS" : "APPROVED",
					"LOGICAL_STATUS_CODE" : "1",
					"CLASSIFICATION_CODE" : "RD",
					"CLASSIFICATION_CODE_DESCRIPTION" : "Dwelling",
					"LOCAL_CUSTODIAN_CODE" : 6805,
					"LOCAL_CUSTODIAN_CODE_DESCRIPTION" : "ISLE OF ANGLESEY",
					"POSTAL_ADDRESS_CODE" : "D",
					"POSTAL_ADDRESS_CODE_DESCRIPTION" : "A record which is linked to PAF",
					"BLPU_STATE_CODE_DESCRIPTION" : "Unknown/Not applicable",
					"TOPOGRAPHY_LAYER_TOID" : "osgb1000033999031",
					"LAST_UPDATE_DATE" : "10/02/2016",
					"ENTRY_DATE" : "30/05/2002",
					"LANGUAGE" : "CY",
					"MATCH" : 0.2,
					"MATCH_DESCRIPTION" : "NO MATCH"
				}
			},{
				"DPA" : {
					"UPRN" : "10011744354",
					"UDPRN" : "13036886",
					"ADDRESS" : "1, RIVERSIDE, LLYSWEN, ABERHONDDU, LD3 0LJ",
					"BUILDING_NUMBER" : "1",
					"THOROUGHFARE_NAME" : "RIVERSIDE",
					"DEPENDENT_LOCALITY" : "LLYSWEN",
					"POST_TOWN" : "ABERHONDDU",
					"POSTCODE" : "LD3 0LJ",
					"RPC" : "1",
					"X_COORDINATE" : 312995.53,
					"Y_COORDINATE" : 238327.04,
					"STATUS" : "APPROVED",
					"LOGICAL_STATUS_CODE" : "1",
					"CLASSIFICATION_CODE" : "RD02",
					"CLASSIFICATION_CODE_DESCRIPTION" : "Detached",
					"LOCAL_CUSTODIAN_CODE" : 6850,
					"LOCAL_CUSTODIAN_CODE_DESCRIPTION" : "POWYS",
					"POSTAL_ADDRESS_CODE" : "D",
					"POSTAL_ADDRESS_CODE_DESCRIPTION" : "A record which is linked to PAF",
					"BLPU_STATE_CODE" : "2",
					"BLPU_STATE_CODE_DESCRIPTION" : "In use",
					"TOPOGRAPHY_LAYER_TOID" : "osgb1000020865533",
					"LAST_UPDATE_DATE" : "10/02/2016",
					"ENTRY_DATE" : "14/10/2004",
					"BLPU_STATE_DATE" : "02/05/2012",
					"LANGUAGE" : "CY",
					"MATCH" : 0.2,
					"MATCH_DESCRIPTION" : "NO MATCH"
				}
			}],
			isOpen = false,
			keyEntryPace = {
			    /*timeout: 3000,
			    entries: [1000],
			    record: function () {
			    	console.log(this);
                },*/
                get: function () {
			    	return 0;
                }
            };

		addressService.setLanguage('EN');

		/**
         * Make sure element is removed from DOM on load
         */
		$details.hide();

		addressComponent.emitter.on('addressSelected', function (e, dataItem) {
			var i;

			/**
             * Populate manual entry fields
             */
			for (i in fieldToDataMap) {
				$('#' + fieldToDataMap[i]).val(dataItem[i]);
            }

			$addressDetailsTrigger.hide();
			$addressStartAgainTrigger.show();

            /**
             * Open field list
             */
			toggleDetails(null, true);
		});

		function toggleDetails (e, toOpen) {
			if (e) {
				e.preventDefault();
            }

			/**
             * If persistent state isn't specified, flip state
			 */
			if (toOpen === undefined) {
				toOpen = !isOpen;
            }

			$details.parent()[toOpen ? 'addClass' : 'removeClass']('is-expanded');
			$details.attr('aria-hidden', !toOpen);
			$addressDetailsTrigger.attr('aria-expanded', toOpen);

			isOpen = toOpen;

			if (toOpen){
				$details.show();
            } else {

				/**
				 * Make sure fields are removed from DOM after animation
				 */
				setTimeout(function () {
					$details.hide();
				}, 300);
            }
        }

        function resetFields (e) {
			e.preventDefault();

			$addressEl.val('');

			for (i in fieldToDataMap) {
				$('#' + fieldToDataMap[i]).val('');
			}

			$addressEl.focus();
        }

        function addressSortAscendingComparator (a, b) {

			var addressValSnapshot = $addressEl.val().replace(' ', '').toUpperCase(),
                aNumber,
				bNumber,
			    aPostCode = a.postCode.replace(' ', '').toUpperCase(),
				bPostCode = b.postCode.replace(' ', '').toUpperCase(),
                priorityIncrement = 100 /* To come from service wrapper */;

			if (a.houseNameOrNumber) {
				aNumber = a.houseNameOrNumber.split(', ')[0].replace(/([a-z A-Z])/g, '');
            }

            if (b.houseNameOrNumber) {
				bNumber = b.houseNameOrNumber.split(', ')[0].replace(/([a-z A-Z])/g, '');
            }

			/**
             * If not comparable guard
             */
			if (!aNumber || !bNumber) {
				if (aNumber) {
					return aNumber;
                }

				if (bNumber) {
					return bNumber;
				}

				return false;
            }

            /**
             * Make all address with postcode matches come first
             */
            if (aPostCode && aPostCode.match(addressValSnapshot)) {
				aNumber -= priorityIncrement * 2;
            }

			if (bPostCode && bPostCode.match(addressValSnapshot)) {
				bNumber -= priorityIncrement * 2;
			}

            return aNumber - bNumber;
        }

		var callService = _.debounce(function (address, attachArr) {

                var serviceCall = addressService.findAddress(address)
                    .then(function (res) {
                        console.log('and then', res);

                        addressComponent.update(
                        	addressService.responseAdaptor(res)
                                .sort(addressSortAscendingComparator));


                    })
                    .catch(function (res) {
                        console.log('and fail', res);
                    });

                /**
                 * Can't return promise from debounce - call is async
                 */
			    $.each(attachArr, function (key, item) {
                    if (item && item.prop && item.method) {
						serviceCall[item.prop](item.method);
					}
                });

            }, keyEntryPace.get());

		$addressStartAgainTrigger.on('click', resetFields);
		$addressDetailsTrigger.on('click', toggleDetails);
		$addressEl.on('keyup', function (e) {
			e.preventDefault();

			var val = $(this).val();

			if (TypeaheadComponent.isKeyPressClean(e)) {
				return;
			}

			if (addressService.request.isInflight) {
				addressService.request.cancel();
			}

			if (val.length < 3) {

				// keyEntryPace.record();

				if (addressComponent.data.length) {
					addressComponent.update([]);
                }

				return;
			}

			/*addressComponent.update(addressService.responseAdaptor({ results: mockData }));

			return;*/

			var shouldAttachScrollToAddressElBool = $('body').prop('scrollWidth') < 485;

			callService(val, shouldAttachScrollToAddressElBool ? [{
				prop: 'then',
				method: function () {
                    $(window).scrollTop($addressEl.parent().prev('.label').offset().top);
                }}] : []);
        });
	});
</script>

<!--<![endif]-->    <!--[if gte IE 9]><!-->

<script src="/s/js/bundle.min.js?q=c9b1d9ca24f114e6b67a88390664a082d7bd52b6"></script>

<!--<![endif]-->
</body>
</html>
